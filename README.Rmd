---
output: github_document
editor_options: 
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  error = FALSE,
  comment = "#>",
  fig.path = "man/figures/README-",
  fig.height = 4,
  fig.width = 9,
  out.width = "100%",
  dpi = 300
)
if (!interactive()) {
  options(width = 99)
}
```

# fflr <img src="man/figures/logo.png" align="right" width="120" />

<!-- badges: start -->
[![Lifecycle: experimental][life_badge]][life_link]
[![CRAN status][cran_badge]][cran_link]
[![Codecov test coverage][cov_badge]][cov_link]
[![R build status][ga_badge]][ga_link]
<!-- badges: end -->

The fflr package is used to query the [ESPN Fantasy Football API][api] for both
the current and prior seasons. Get data on fantasy league members, teams, and
individual athletes.

This package was designed and tested for my own 10-man standard league. Most
functions should for other leagues, but contributions are welcome.

## Installation

You can install the released version of `fflr` from [GitHub][fflr] with:

```r
# install.packages("remotes")
remotes::install_github("kiernann/fflr")
```

## Usage

Here we see how to scrape teams, rosters, scores, and waiver pickups.

Use `set_lid()` to easily define your league ID (from the URL) in `options()`.

```{r set_lid}
library(fflr)
library(ffplot)
library(tidyverse)
set_lid(252353) # check URL
```

```{r team_roster}
rosters <- team_roster(week = ffl_week(-1))
(my_roster <- rosters[[5]][-5])
```

```{r best_roster}
my_best <- best_roster(my_roster)
roster_score(my_roster)
roster_score(my_best)
```

Matchups return as a [tidy](https://w.wiki/Jzz) tibble of weekly scores by team.

```{r league_teams}
(teams <- league_teams()[, -3])
scores <- match_scores()
```

This makes scores over the season easy to plot. The **experimental** [ffplot] 
package makes such plots automatically. 

```{r plot_scores, echo=FALSE}
weekly_scores(scores)
```

Some functions like `roster_moves()` only define players by their unique ID.

```{r waiver_adds}
waiver_adds <- 
  roster_moves(week = 3) %>% 
  filter(
    type == "WAIVER", 
    status == "EXECUTED",
    move == "ADD"
  )
```

The included `nfl_players` tibble identifies all `r nrow(nfl_players)` players
(as of September 30th, 2020).

```{r join_player}
waiver_adds %>% 
  left_join(nfl_players) %>% 
  select(15:18, bid, team = to_team) %>%
  left_join(teams[, 1:2]) %>% 
  arrange(desc(bid))
```

***

The fflr project is released with a [Contributor Code of Conduct][coc]. By
contributing to this project, you agree to abide by its terms.

<!-- refs: start -->
[life_badge]: https://img.shields.io/badge/lifecycle-experimental-orange.svg
[life_link]: https://www.tidyverse.org/lifecycle/#experimental
[cran_badge]: https://www.r-pkg.org/badges/version/fflr
[cran_link]: https://CRAN.R-project.org/package=fflr
[ga_badge]: https://github.com/kiernann/fflr/workflows/R-CMD-check/badge.svg
[ga_link]: https://github.com/kiernann/fflr/actions
[cov_badge]: https://codecov.io/gh/kiernann/ffplot/branch/master/graph/badge.svg
[cov_link]: https://codecov.io/gh/kiernann/fflr?branch=master
[dl_badge]: https://cranlogs.r-pkg.org/badges/grand-total/fflr
[api]: https://fantasy.espn.com/apis/v3/games/ffl/
[ffplot]: https://github.com/kiernann/ffplot
[fflr]: https://github.com/kiernann/fflr
[coc]: https://contributor-covenant.org/version/1/0/0/CODE_OF_CONDUCT.html
<!-- refs: end -->
